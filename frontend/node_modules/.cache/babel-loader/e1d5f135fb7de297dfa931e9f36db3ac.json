{"ast":null,"code":"import _toConsumableArray from \"/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/src/components/productList.jsx\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport Product from \"./product\";\nimport Transaction from \"./transaction\";\n\nvar ProductList =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ProductList, _Component);\n\n  function ProductList() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, ProductList);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(ProductList)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      productsToBuy: [],\n      transactions: [],\n      deposit: 0\n    };\n\n    _this.buyProduct = function (product, username) {\n      var obj = {};\n      obj.username = username;\n      obj.productId = product.productId;\n      obj.name = product.name;\n      obj.price = product.price;\n      obj.description = product.description;\n      obj.owner = product.owner;\n      axios({\n        method: 'post',\n        url: 'http://localhost:4000/consortium/buy',\n        data: obj,\n        config: {\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        }\n      }).then(function (res) {\n        _this.setState(function (prevState) {\n          var productsToBuy = prevState.productsToBuy.filter(function (p) {\n            return p.productId !== product.productId;\n          });\n          return {\n            productsToBuy: productsToBuy\n          };\n        });\n      }).catch(function (error) {\n        console.log(error);\n      });\n    };\n\n    _this.listProducts = function (username, page, buyProduct) {\n      return _this.state.productsToBuy.map(function (currentProduct, i) {\n        if (username !== currentProduct.owner) {\n          return React.createElement(Product, {\n            page: page,\n            product: currentProduct,\n            username: username,\n            key: i,\n            buyProduct: buyProduct,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 62\n            },\n            __self: this\n          });\n        }\n      });\n    };\n\n    _this.handleDeposit = function (text) {\n      _this.setState({\n        deposit: text.target.value\n      });\n    };\n\n    _this.settlePayment = function (transaction, wallet) {\n      console.log(wallet);\n      console.log(transaction);\n\n      if (!wallet < transaction.amount) {\n        var obj = {};\n        obj.buyer = transaction.buyer;\n        obj.seller = transaction.seller;\n        obj.amount = transaction.amount;\n        obj.productId = transaction.productId;\n        axios({\n          method: 'post',\n          url: 'http://localhost:4000/consortium/settle_payment',\n          data: obj,\n          config: {\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          }\n        }).then(function (res) {\n          var t = _toConsumableArray(_this.state.transactions);\n\n          var index = t.indexOf(transaction);\n\n          if (index !== -1) {\n            t.splice(index, 1);\n\n            _this.setState({\n              transactions: t\n            });\n          }\n        }).catch(function (error) {\n          console.log(error);\n        });\n      }\n    };\n\n    _this.listTransactions = function (username, settlePayment, wallet) {\n      return _this.state.transactions.map(function (currentTransaction, i) {\n        if (username === currentTransaction.buyer) {\n          return React.createElement(Transaction, {\n            transaction: currentTransaction,\n            wallet: wallet,\n            key: i,\n            settlePayment: settlePayment,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 109\n            },\n            __self: this\n          });\n        }\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(ProductList, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      axios.get('http://localhost:4000/consortium/products').then(function (products) {\n        _this2.setState({\n          productsToBuy: products.data\n        });\n\n        axios.get('http://localhost:4000/consortium/transactions').then(function (trans) {\n          _this2.setState({\n            transactions: trans.data\n          });\n        }).catch(function (error) {\n          console.log(error);\n        });\n      }).catch(function (error) {\n        console.log(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }, \"Products to buy\"), React.createElement(\"table\", {\n        className: \"table table-striped\",\n        style: {\n          marginTop: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, \"ID\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      }, \"Name\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      }, \"Price\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, \"Description\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, \"Seller\"))), React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, this.listProducts(this.props.props.username, this.props.props.page, this.buyProduct))), React.createElement(\"div\", {\n        className: \"form-inline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        htmlFor: \"deposit\",\n        className: \"col-form-label\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }, \"Deposit: \"), React.createElement(\"input\", {\n        type: \"number\",\n        placeholder: \"Enter deposit: \",\n        id: \"deposit\",\n        className: \"form-control\",\n        onChange: function onChange(text) {\n          return _this3.handleDeposit(text);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        className: \"btn btn-primary btn-sm m-2\",\n        onClick: function onClick() {\n          return _this3.props.depositMoney(_this3.props.props.username, _this3.state.deposit);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }, \"Deposit\")), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      }, \"Transactions to settle\"), React.createElement(\"table\", {\n        className: \"table table-striped\",\n        style: {\n          marginTop: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, \"Creditor\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, \"Amount\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, \"Product ID\"))), React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, this.listTransactions(this.props.props.username, this.settlePayment, this.props.props.user.wallet))));\n    }\n  }]);\n\n  return ProductList;\n}(Component);\n\nexport { ProductList as default };","map":{"version":3,"sources":["/Users/madhusudansaha/MS/Spring_2019/526-Blockchain/Projects/Project1/msahaLab1/part1/consortium/src/components/productList.jsx"],"names":["React","Component","axios","Product","Transaction","ProductList","state","productsToBuy","transactions","deposit","buyProduct","product","username","obj","productId","name","price","description","owner","method","url","data","config","headers","then","res","setState","prevState","filter","p","catch","error","console","log","listProducts","page","map","currentProduct","i","handleDeposit","text","target","value","settlePayment","transaction","wallet","amount","buyer","seller","t","index","indexOf","splice","listTransactions","currentTransaction","get","products","trans","marginTop","props","depositMoney","user"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\n\nimport Product from \"./product\";\nimport Transaction from \"./transaction\";\n\nexport default class ProductList extends Component {\n\n    state = {\n\tproductsToBuy: [],\n\ttransactions: [],\n\tdeposit: 0\n    };\n\n    componentDidMount() {\n\taxios.get('http://localhost:4000/consortium/products')\n\t    .then(products => {\n\t\tthis.setState({productsToBuy: products.data});\n\t\t\n\t\taxios.get('http://localhost:4000/consortium/transactions')\n\t\t    .then(trans => {\n\t\t\tthis.setState({transactions: trans.data});\n\t\t    })\n\t\t    .catch(function (error){\n\t\t\tconsole.log(error);\n\t\t    })\t\t\n\t    })\n\t    .catch(function (error){\n                console.log(error);\n\t    })\t\n    }\n\n    buyProduct = (product, username) => {\n\tlet obj = {};\n\tobj.username = username;\n\tobj.productId = product.productId;\n\tobj.name = product.name;\n\tobj.price = product.price;\n\tobj.description = product.description;\n\tobj.owner = product.owner;\n\t\n\taxios({\n\t    method: 'post',\n\t    url: 'http://localhost:4000/consortium/buy',\n\t    data: obj,\n\t    config: { headers: {'Content-Type': 'application/json' }}\n\t})\n\t    .then(res => {\n\t\tthis.setState(prevState => {\n\t\t    const productsToBuy = prevState.productsToBuy.filter(p => p.productId !== product.productId);\n\t\t    return { productsToBuy };\n\t\t});\n\t    })\n\t    .catch(function (error){\n                console.log(error);\n\t    })\t\n    }\n    \n    listProducts = (username, page, buyProduct) => {\n        return this.state.productsToBuy.map(function(currentProduct, i){\n\t    if(username !== currentProduct.owner) {\n\t\treturn <Product\n\t\tpage={page}\n\t\tproduct={currentProduct}\n\t\tusername={username}\n\t\tkey={i}\n\t\tbuyProduct={buyProduct} />;\n\t    }\n        })\n    }\n\n    handleDeposit = (text) => {\n\tthis.setState({deposit: text.target.value})\n    }\n\n    settlePayment = (transaction, wallet) => {\n\tconsole.log(wallet);\n\tconsole.log(transaction);\n\tif(!wallet < transaction.amount) {\n\t    let obj = {};\n\t    obj.buyer = transaction.buyer;\n\t    obj.seller = transaction.seller;\n\t    obj.amount = transaction.amount;\n\t    obj.productId = transaction.productId;\n\t    \n\t    axios({\n\t\tmethod: 'post',\n\t\turl: 'http://localhost:4000/consortium/settle_payment',\n\t\tdata: obj,\n\t\tconfig: { headers: {'Content-Type': 'application/json' }}\n\t    })\n\t\t.then(res => {\n\t\t    let t = [...this.state.transactions];\n\t\t    var index = t.indexOf(transaction)\n\t\t    if (index !== -1) {\n\t\t\tt.splice(index, 1);\n\t\t\tthis.setState({transactions: t});\n\t\t    }\n\t\t})\n\t\t.catch(function (error){\n                    console.log(error);\n\t\t})\n\t}\n    }\n    \n\tlistTransactions = (username, settlePayment, wallet) => {\n        return this.state.transactions.map(function(currentTransaction, i){\n\t    if(username === currentTransaction.buyer) {\n\t\treturn <Transaction\n\t\ttransaction={currentTransaction}\n\t\twallet={wallet}\n\t\tkey={i}\n\t\tsettlePayment={settlePayment} />;\n\t    }\n        })\n    }\n\n    render() {\n        return (\n\t    <div>\n              <h3>Products to buy</h3>\n              <table className=\"table table-striped\" style={{ marginTop: 20 }} >\n                <thead>\n                  <tr>\n\t\t    <th>ID</th>\n                    <th>Name</th>\n                    <th>Price</th>\n                    <th>Description</th>\n                    <th>Seller</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  { this.listProducts(this.props.props.username, this.props.props.page, this.buyProduct) }\n                </tbody>\n              </table>\n\t      \n\t      <div className=\"form-inline\">\n\t      <label htmlFor=\"deposit\" className=\"col-form-label\">Deposit: </label>\n\t      <input type=\"number\" placeholder=\"Enter deposit: \" id=\"deposit\" className=\"form-control\" onChange={(text) => this.handleDeposit(text)} />\n\t\t<button className=\"btn btn-primary btn-sm m-2\" onClick={() => this.props.depositMoney(this.props.props.username, this.state.deposit)}>Deposit</button>\n\t      </div>\n\n\t      <h3>Transactions to settle</h3>\n              <table className=\"table table-striped\" style={{ marginTop: 20 }} >\n                <thead>\n                  <tr>\n\t\t    <th></th>\n                    <th>Creditor</th>\n                    <th>Amount</th>\n                    <th>Product ID</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  { this.listTransactions(this.props.props.username, this.settlePayment, this.props.props.user.wallet) }\n                </tbody>\n              </table>\n\t      \n            </div>\n        )\n    }\n}\n"]},"metadata":{},"sourceType":"module"}